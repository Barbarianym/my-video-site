<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Autoplay Video</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        background-color: black;
        overflow: hidden;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
        font-family: sans-serif;
    }
    video {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }
    .loader-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 2;
    }
    .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px auto;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    #prevVideoButton, #nextVideoButton {
        position: fixed;
        padding: 15px 30px;
        font-size: 16px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: gray;
        color: white;
        z-index: 3;
    }
    #prevVideoButton { top: 85%; left: 25%; transform: translate(-50%, -50%); }
    #nextVideoButton { top: 85%; left: 75%; transform: translate(-50%, -50%); }

    /* Sound overlay button */
    #enableSoundButton {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 20px 40px;
        font-size: 18px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        background: white;
        color: black;
        z-index: 4;
        display: none; /* show only if sound needs enabling */
    }
</style>
</head>
<body>

<video id="autoVideo" playsinline autoplay loop muted></video>

<div class="loader-container" id="loaderContainer">
    <div class="loader"></div>
    <div>Loading video...</div>
</div>

<button id="prevVideoButton">Watch Previous Video</button>
<button id="nextVideoButton">Watch Next Video</button>

<button id="enableSoundButton">Tap to enable sound</button>

<script>
    const video = document.getElementById('autoVideo');
    const loaderContainer = document.getElementById('loaderContainer');
    const prevButton = document.getElementById('prevVideoButton');
    const nextButton = document.getElementById('nextVideoButton');
    const enableSoundButton = document.getElementById('enableSoundButton');

    // ---------------------------
    // Playlist of videos
    // ---------------------------
    const videoPlaylist = [
        './videos/myvideo.mp4' // add more videos here
    ];

    let currentIndex = 0;

    // ---------------------------
    // Helper: get persistent view count
    // ---------------------------
    function getViewCount(videoPath) {
        const videoName = videoPath.split('/').pop();
        return parseInt(localStorage.getItem(`viewCount_${videoName}`) || '0');
    }

    function incrementViewCount(videoPath) {
        const videoName = videoPath.split('/').pop();
        let count = getViewCount(videoPath) + 1;
        localStorage.setItem(`viewCount_${videoName}`, count);
        return count;
    }

    // ---------------------------
    // Show/hide loader
    // ---------------------------
    function showLoader(show) {
        loaderContainer.style.display = show ? 'block' : 'none';
    }

    // ---------------------------
    // Load video function
    // ---------------------------
    function loadVideo(index) {
        if(index < 0 || index >= videoPlaylist.length) return;
        currentIndex = index;
        const currentVideoPath = videoPlaylist[currentIndex];
        video.src = currentVideoPath;
        video.load();
        video.muted = true;
        showLoader(true);

        // Show/hide navigation buttons
        if(videoPlaylist.length === 1) {
            prevButton.style.display = 'none';
            nextButton.style.display = 'none';
        } else {
            prevButton.style.display = currentIndex === 0 ? 'none' : 'inline-block';
            nextButton.style.display = currentIndex === videoPlaylist.length - 1 ? 'none' : 'inline-block';
        }

        // Attempt autoplay
        video.play().then(() => {
            showLoader(false);
            // Show sound button only if video is muted
            if(video.muted) enableSoundButton.style.display = 'block';
        }).catch(err => {
            console.log('Autoplay blocked, waiting...', err);
            enableSoundButton.style.display = 'block';
        });
    }

    // ---------------------------
    // Increment view counter when video starts playing
    // ---------------------------
    video.addEventListener('playing', () => {
        showLoader(false);
        enableSoundButton.style.display = 'none'; // hide overlay if visible
        const currentVideoPath = videoPlaylist[currentIndex];
        const newCount = incrementViewCount(currentVideoPath);
        console.log(`Video ${currentIndex + 1} viewed ${newCount} times (persistent)`);
    });

    // ---------------------------
    // Sound overlay button
    // ---------------------------
    enableSoundButton.addEventListener('click', () => {
        video.muted = false;
        video.play();
        enableSoundButton.style.display = 'none';
    });

    // ---------------------------
    // Navigation buttons
    // ---------------------------
    nextButton.addEventListener('click', () => {
        if(currentIndex < videoPlaylist.length - 1) loadVideo(currentIndex + 1);
    });

    prevButton.addEventListener('click', () => {
        if(currentIndex > 0) loadVideo(currentIndex - 1);
    });

    // ---------------------------
    // Initialize first video
    // ---------------------------
    loadVideo(currentIndex);

    // ---------------------------
    // Optional: reset all view counts manually
    // ---------------------------
    function resetAllViewCounts() {
        videoPlaylist.forEach(path => {
            const videoName = path.split('/').pop();
            localStorage.removeItem(`viewCount_${videoName}`);
        });
        console.log('All view counts reset.');
    }
</script>

</body>
</html>
