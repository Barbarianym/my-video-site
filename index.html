<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Autoplay Video</title>
<style>
    :root {
        --button-bg: rgba(80, 80, 80, 0.7);
        --button-hover-bg: rgba(120, 120, 120, 0.9);
        --loader-size: 60px;
    }

    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: black;
        overflow: hidden;
        font-family: system-ui, sans-serif;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
        background-color: black;
    }

    .loader-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 2;
        transition: opacity 0.3s ease;
        padding: 20px;
        border-radius: 12px;
        background: rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(4px);
    }

    .loader {
        border: 6px solid #f3f3f3;
        border-top: 6px solid #3498db;
        border-radius: 50%;
        width: var(--loader-size);
        height: var(--loader-size);
        animation: spin 1s linear infinite;
        margin: 0 auto 10px auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    #prevVideoButton, #nextVideoButton {
        position: fixed;
        padding: 12px 22px;
        font-size: clamp(12px, 3vw, 18px);
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: var(--button-bg);
        color: white;
        z-index: 3;
        transition: background 0.2s ease;
    }

    #prevVideoButton:hover, #nextVideoButton:hover {
        background: var(--button-hover-bg);
    }

    #prevVideoButton {
        bottom: 10%;
        left: 10%;
    }

    #nextVideoButton {
        bottom: 10%;
        right: 10%;
    }

    #soundToggle {
        position: absolute;
        top: env(safe-area-inset-top, 10px);
        left: env(safe-area-inset-left, 10px);
        width: 42px;
        height: 42px;
        z-index: 4;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 22px;
        color: white;
        background: rgba(0,0,0,0.4);
        border-radius: 50%;
        user-select: none;
        touch-action: manipulation;
    }

    /* Mobile adjustments */
    @media (max-width: 768px) {
        .loader {
            width: 50px;
            height: 50px;
            border-width: 5px;
        }
        .loader-container {
            padding: 15px;
        }
        #prevVideoButton, #nextVideoButton {
            padding: 10px 18px;
            font-size: clamp(10px, 3vw, 16px);
        }
        #soundToggle {
            width: 38px;
            height: 38px;
            font-size: 20px;
        }
    }

    @media (orientation: portrait) {
        #prevVideoButton, #nextVideoButton {
            bottom: 8%;
        }
    }

</style>
</head>
<body>

<video id="autoVideo" playsinline autoplay muted></video>

<div class="loader-container" id="loaderContainer">
    <div class="loader"></div>
    <div id="loaderText">Loading video...</div>
</div>

<button id="prevVideoButton">Previous</button>
<button id="nextVideoButton">Next</button>

<div id="soundToggle">ðŸ”‡</div>

<script>
const video = document.getElementById('autoVideo');
const loaderContainer = document.getElementById('loaderContainer');
const loaderText = document.getElementById('loaderText');
const prevButton = document.getElementById('prevVideoButton');
const nextButton = document.getElementById('nextVideoButton');
const soundToggle = document.getElementById('soundToggle');

const videoPlaylist = [
    './videos/myvideo.mp4',
    './videos/myvideo2.mp4'
];

let currentIndex = 0;
let hasStartedMoving = false;
let isBuffering = false;
let lastTime = 0;
let movingCheckInterval = null;

function getViewCount(videoPath) {
    const videoName = videoPath.split('/').pop();
    return parseInt(localStorage.getItem(`viewCount_${videoName}`) || '0');
}

function incrementViewCount(videoPath) {
    const videoName = videoPath.split('/').pop();
    let count = getViewCount(videoPath) + 1;
    localStorage.setItem(`viewCount_${videoName}`, count);
    return count;
}

function showLoader(show, text = 'Loading video...') {
    loaderText.textContent = text;
    loaderContainer.style.display = show ? 'block' : 'none';
    loaderContainer.style.opacity = show ? '1' : '0';
}

function loadVideo(index) {
    if (index < 0 || index >= videoPlaylist.length) return;
    currentIndex = index;
    const currentVideoPath = videoPlaylist[currentIndex];
    video.src = currentVideoPath;
    video.load();
    video.muted = true;
    soundToggle.textContent = 'ðŸ”‡';
    showLoader(true, 'Loading video...');
    hasStartedMoving = false;
    isBuffering = false;
    lastTime = 0;

    prevButton.style.display = currentIndex === 0 ? 'none' : 'inline-block';
    nextButton.style.display = currentIndex === videoPlaylist.length - 1 ? 'none' : 'inline-block';

    video.play().catch(err => console.log('Autoplay blocked:', err));

    if (movingCheckInterval) clearInterval(movingCheckInterval);
    movingCheckInterval = setInterval(() => {
        if (!video.paused && video.readyState > 2) {
            if (video.currentTime > lastTime + 0.05) {
                if (!hasStartedMoving) {
                    hasStartedMoving = true;
                    showLoader(false);
                    const newCount = incrementViewCount(currentVideoPath);
                    console.log(`Video ${currentIndex + 1} viewed ${newCount} times`);
                }
                if (isBuffering) {
                    showLoader(false);
                    isBuffering = false;
                }
                lastTime = video.currentTime;
            }
        }
    }, 200);
}

video.addEventListener('waiting', () => {
    if (hasStartedMoving) {
        isBuffering = true;
        showLoader(true, 'Buffering...');
    }
});

video.addEventListener('ended', () => {
    let nextIndex = currentIndex + 1;
    if (nextIndex >= videoPlaylist.length) nextIndex = 0;
    loadVideo(nextIndex);
});

soundToggle.addEventListener('click', () => {
    video.muted = !video.muted;
    soundToggle.textContent = video.muted ? 'ðŸ”‡' : 'ðŸ”Š';
    if (!video.muted) video.play().catch(() => {});
});

nextButton.addEventListener('click', () => {
    let nextIndex = currentIndex + 1;
    if (nextIndex >= videoPlaylist.length) nextIndex = 0;
    loadVideo(nextIndex);
});

prevButton.addEventListener('click', () => {
    let prevIndex = currentIndex - 1;
    if (prevIndex < 0) prevIndex = videoPlaylist.length - 1;
    loadVideo(prevIndex);
});

loadVideo(currentIndex);
</script>

</body>
</html>
