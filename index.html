<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Autoplay Video</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        background-color: black;
        overflow: hidden;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
        font-family: sans-serif;
    }
    video {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }
    .loader-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 2;
    }
    .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #3498db;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px auto;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    #prevVideoButton, #nextVideoButton {
        position: fixed;
        padding: 15px 30px;
        font-size: 16px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: gray;
        color: white;
        z-index: 3;
    }
    #prevVideoButton { top: 85%; left: 25%; transform: translate(-50%, -50%); }
    #nextVideoButton { top: 85%; left: 75%; transform: translate(-50%, -50%); }

    /* Small sound toggle icon */
    #soundToggle {
        position: absolute;
        top: 15px;
        left: 15px;
        width: 40px;
        height: 40px;
        z-index: 4;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        color: white;
        background: rgba(0,0,0,0.4);
        border-radius: 50%;
        user-select: none;
    }
</style>
</head>
<body>

<video id="autoVideo" playsinline autoplay muted></video>

<div class="loader-container" id="loaderContainer">
    <div class="loader"></div>
    <div>Loading video...</div>
</div>

<button id="prevVideoButton">Watch Previous Video</button>
<button id="nextVideoButton">Watch Next Video</button>

<div id="soundToggle">🔇</div>

<script>
    const video = document.getElementById('autoVideo');
    const loaderContainer = document.getElementById('loaderContainer');
    const prevButton = document.getElementById('prevVideoButton');
    const nextButton = document.getElementById('nextVideoButton');
    const soundToggle = document.getElementById('soundToggle');

    // ---------------------------
    // ✅ Playlist of videos
    // ---------------------------
    const videoPlaylist = [
        './videos/myvideo.mp4',
        './videos/myvideo2.mp4'
    ];

    let currentIndex = 0;

    // ---------------------------
    // Persistent view count (localStorage)
    // ---------------------------
    function getViewCount(videoPath) {
        const videoName = videoPath.split('/').pop();
        return parseInt(localStorage.getItem(`viewCount_${videoName}`) || '0');
    }

    function incrementViewCount(videoPath) {
        const videoName = videoPath.split('/').pop();
        let count = getViewCount(videoPath) + 1;
        localStorage.setItem(`viewCount_${videoName}`, count);
        return count;
    }

    // ---------------------------
    // Show/hide loader
    // ---------------------------
    function showLoader(show) {
        loaderContainer.style.display = show ? 'block' : 'none';
    }

    // ---------------------------
    // Load and play a video
    // ---------------------------
    function loadVideo(index) {
        if (index < 0 || index >= videoPlaylist.length) return;
        currentIndex = index;
        const currentVideoPath = videoPlaylist[currentIndex];
        video.src = currentVideoPath;
        video.load();
        video.muted = true;
        soundToggle.textContent = '🔇';
        showLoader(true);

        // Manage navigation buttons
        if (videoPlaylist.length === 1) {
            prevButton.style.display = 'none';
            nextButton.style.display = 'none';
        } else {
            prevButton.style.display = currentIndex === 0 ? 'none' : 'inline-block';
            nextButton.style.display = currentIndex === videoPlaylist.length - 1 ? 'none' : 'inline-block';
        }

        video.play().then(() => {
            showLoader(false);
        }).catch(err => {
            console.log('Autoplay blocked, waiting for interaction:', err);
        });
    }

    // ---------------------------
    // Increment view count when video starts playing
    // ---------------------------
    video.addEventListener('playing', () => {
        showLoader(false);
        const currentVideoPath = videoPlaylist[currentIndex];
        const newCount = incrementViewCount(currentVideoPath);
        console.log(`Video ${currentIndex + 1} viewed ${newCount} times (persistent)`);
    });

    // ---------------------------
    // 🔁 Autoplay next video when current ends
    // ---------------------------
    video.addEventListener('ended', () => {
        let nextIndex = currentIndex + 1;
        if (nextIndex >= videoPlaylist.length) {
            nextIndex = 0; // loop back to first video
        }
        loadVideo(nextIndex);
    });

    // ---------------------------
    // Sound toggle icon
    // ---------------------------
    soundToggle.addEventListener('click', () => {
        video.muted = !video.muted;
        soundToggle.textContent = video.muted ? '🔇' : '🔊';
        if (!video.muted) {
            video.play().catch(() => {}); // ensure playback resumes
        }
    });

    // ---------------------------
    // Navigation buttons
    // ---------------------------
    nextButton.addEventListener('click', () => {
        let nextIndex = currentIndex + 1;
        if (nextIndex >= videoPlaylist.length) nextIndex = 0; // loop to first
        loadVideo(nextIndex);
    });

    prevButton.addEventListener('click', () => {
        let prevIndex = currentIndex - 1;
        if (prevIndex < 0) prevIndex = videoPlaylist.length - 1; // loop to last
        loadVideo(prevIndex);
    });

    // ---------------------------
    // Initialize the first video
    // ---------------------------
    loadVideo(currentIndex);

    // ---------------------------
    // Optional: reset all view counts manually (run in console)
    // ---------------------------
    function resetAllViewCounts() {
        videoPlaylist.forEach(path => {
            const videoName = path.split('/').pop();
            localStorage.removeItem(`viewCount_${videoName}`);
        });
        console.log('All view counts reset.');
    }
</script>

</body>
</html>
